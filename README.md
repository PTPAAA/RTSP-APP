# RTSP摄像头 - 旧手机变身监控摄像头

将闲置的安卓手机改造成网络监控摄像头，通过RTSP协议推流，可无缝对接EasyNVR等NVR系统。

## 功能特性

### 核心功能
- ✅ **RTSP推流** - 标准RTSP/RTP协议，兼容主流NVR
- ✅ **多档画质** - 极低/低/中/高预设，支持自定义
- ✅ **闪光灯控制** - 手动开关或自动感光模式
- ✅ **网络限制** - 仅IPv4 / 仅局域网模式

### 增强功能 (新)
- ✅ **多码流** - 同时提供主码流(高清)和子码流(流畅)
- ✅ **OSD水印** - 叠加时间戳、电池电量、温度、自定义文本
- ✅ **夜视增强** - 亮度增强、对比度调整、软件降噪
- ✅ **高级保活** - WakeLock + WifiLock + 定时唤醒 + 屏幕监听
- ✅ **电池监控** - 实时电量、温度、充电状态显示

### 其他功能
- ✅ 后台保活（前台服务 + WakeLock）
- ✅ 开机自启动
- ✅ 前后摄像头切换
- ✅ 音频推流（可选）

## 多码流支持

启用多码流后，可同时访问两个不同质量的视频流：

| 码流   | 路径  | 分辨率   | 码率     | 适用场景     |
| ------ | ----- | -------- | -------- | ------------ |
| 主码流 | /main | 用户设置 | 用户设置 | 本地高清查看 |
| 子码流 | /sub  | 640×480  | 384kbps  | 远程流畅播放 |
| 兼容   | /live | = 主码流 | = 主码流 | 向后兼容     |

### RTSP地址格式
```
主码流: rtsp://<手机IP>:8554/main
子码流: rtsp://<手机IP>:8554/sub
兼容:   rtsp://<手机IP>:8554/live
```

## OSD水印

在视频画面上实时叠加信息：

- **时间戳** - 当前日期和时间 (2026-01-29 19:15:00)
- **电池电量** - 电量百分比和充电状态 (⚡85%)
- **电池温度** - 设备发热情况 (32.5°C)
- **自定义文本** - 用户定义的文字（如摄像头位置）

## 夜视增强

暗光环境下的画质优化：

| 参数       | 范围     | 默认值 | 说明                 |
| ---------- | -------- | ------ | -------------------- |
| 亮度增强   | 100-300% | 150%   | 提升整体画面亮度     |
| 对比度增强 | 100-200% | 120%   | 增强明暗对比         |
| 降噪强度   | 0-100%   | 30%    | 减少暗光噪点         |
| 自动调整   | 开/关    | 开     | 根据画面亮度自动调整 |

## 画质预设

| 档位 | 分辨率    | 码率    | 帧率  | 每日存储 |
| ---- | --------- | ------- | ----- | -------- |
| 极低 | 320×240   | 128kbps | 10fps | ~1.4GB   |
| 低   | 640×480   | 512kbps | 15fps | ~5.5GB   |
| 中   | 1280×720  | 1Mbps   | 24fps | ~10.8GB  |
| 高   | 1920×1080 | 2Mbps   | 30fps | ~21.6GB  |

## EasyNVR对接

### 配置步骤
1. 确保手机和EasyNVR在同一局域网
2. 在App中点击「开始推流」
3. 复制显示的RTSP地址
4. EasyNVR后台 → 添加设备 → 选择「通用RTSP」
5. 粘贴RTSP地址，选择TCP传输
6. 保存即可看到画面

### 推荐配置
- **高清录像**: 使用主码流 `/main`
- **远程查看**: 使用子码流 `/sub`，减少带宽
- **传输协议**: TCP模式更稳定

## 使用说明

### 权限说明
- **相机权限** - 视频采集必需
- **麦克风权限** - 音频推流时需要
- **网络权限** - RTSP服务必需

### 注意事项
- 建议使用WiFi连接，确保网络稳定
- 长时间运行建议插电使用
- 开启「仅局域网」模式提高安全性
- 自动闪光灯模式需要有光线传感器
- 夜视增强会增加CPU负载，注意发热

## 构建方法

```bash
# 克隆项目后，使用Android Studio打开
# 或使用Gradle命令行构建

./gradlew assembleDebug
```

## 技术架构

```
├── camera/             # Camera2 相机管理
├── encoder/            # MediaCodec H.264编码
├── rtsp/               # RTSP服务器 + RTP打包
│   ├── RTSPServer.kt         # 单码流服务器
│   └── MultiStreamRTSPServer.kt  # 多码流服务器
├── overlay/            # OSD水印渲染
├── processing/         # 夜视增强处理
├── keepalive/          # 高级保活管理
├── sensor/             # 光线传感器
├── service/            # 前台服务
├── model/              # 数据模型
├── util/               # 工具类
└── ui/                 # 界面
```

## 最低要求
- Android 5.0 (API 21) 及以上
- 支持H.264硬件编码的设备

## 更新日志

### v1.1.0 (2026-01-29)
- 新增: 多码流支持（主码流/子码流）
- 新增: OSD水印（时间戳、电池、温度、自定义文本）
- 新增: 夜视增强（亮度/对比度/降噪）
- 新增: 高级保活机制
- 优化: 电池状态实时监控

### v1.0.0
- 初始版本
- 基础RTSP推流功能

## License
MIT License
